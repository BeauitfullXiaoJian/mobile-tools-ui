<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="./../../../resource/css/index.css">
    <link rel="stylesheet" href="./../../../resource/font/iconfont.css">
</head>

<body class="bg-white">
    <div class="view">
        <div class="view-headbar bg-danger">
            <div class="headbar-title text-center">播放</div>
        </div>
        <div class="view-content">

        </div>
    </div>
</body>
<script src="./../../../resource/js/jquery.min.js"></script>
<script>
    var cookie = localStorage.getItem('cookie'), account = localStorage.getItem('account'), cookieStr = '';
    cookie = cookie && JSON.parse(cookie);
    account = account && JSON.parse(account);
    cookie.forEach(function (str, index) {
        cookie[index] = str.split(';')[0];
    });
    $.ajax({
        url: 'http://www.cool1024.com:3000/song/detail?timestamp=' + new Date().getTime(),
        dataType: 'json',
        data: { cookie: cookie.join(';'), ids: getUrlParam('ids') },
        type: 'post',
        success: function (res) {
            if (res.code === 200) {
                document.getElementsByClassName('view-content').item(0).innerHTML += getCardMediaStr(res.songs.pop().al);
            }
        }
    });

    $.ajax({
        url: 'http://www.cool1024.com:3000/music/url?timestamp=' + new Date().getTime(),
        dataType: 'json',
        data: { cookie: cookie.join(';'), id: getUrlParam('ids'), br: 320000 },
        type: 'post',
        success: function (res) {
            if (res.code === 200) {
                console.log(res);
                playMusic(res.data.pop().url);
            }
        }
    });

    function getCardMediaStr(media) {
        return `
            <div class="card card-media mb-2">
                <div class="card-media-thumb">
                    <img class="w-100 h-100" src="${media.picUrl}">
                </div>
                <div class="card-media-content">
                    <h4 class="text-truncate">${media.name}</h4>
                </div>
            </div>`;
    }

    function playMusic(src) {
        document.getElementsByClassName('view-content').item(0).innerHTML += `<audio controls src="${src}"></audio>`;
    }

    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]); return null;
    }
</script>

</html>